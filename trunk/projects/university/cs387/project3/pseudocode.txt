sort(A)
sort(B)
B.min = 0
A.max = size(A)-1

B:
  receive(top X elements from A in descending order)

  stopflag = 0
  for i=0..X
    if new[i] > B[B.min]
      add_to_send_queue(B[B.min])
      B[B.min] = new[i]
  
      if new[i] < B[B.min+1]
	B.min++
      else
        stopflag = 1
        break
  endfor

  sendqueue(A, stopflag); (and this starts the similar thing in A)
	// Just make sure that stopflag is at the beginning of the message, so that A knows which number is the flag

A:
  send(top X elements in descending order to B)
  receive(stopflag, Y queued elements from B)

  A.max = size(a)-1

  for i=0..Y
    A[A.max] = new[i]
    A.max--
  endfor

  if (A[A.max+1] > A[A.max])
    A.max++
  else
    stopflag = 1 // We'll check this next, anyway, so set it to 1 in case it was 0
  If stopflag, break


resort_A:
  new new_array
  i = 0
  A.begin = 0
  A.end = size(A) - 1

  while (A.begin != A.end)
    if A[A.begin] < A[A.end]
      new_array[i] = A[A.begin]
      A.begin++
    else
      new_array[i] = A[A.end]
      A.end--
    i++
  new_array[i] = A[A.end]